@tailwind base;
@tailwind components;
@tailwind utilities;

/* --------------------------------------------------
   Palette centralisée (CSS Variables)
   Objectif: cohérence visuelle + facilité de theming
   Utilisation côté JSX: bg-[var(--color-surface)] / text-[var(--color-text)] etc.
   -------------------------------------------------- */
:root {
  --color-bg: #f8fafc;           /* slate-50 */
  --color-surface: #ffffff;      /* white */
  --color-surface-alt: #f1f5f9;  /* slate-100 */
  --color-border: #e2e8f0;       /* slate-200 */
  --color-border-strong: #cbd5e1;/* slate-300 */
  --color-text: #0f172a;         /* slate-900 */
  --color-text-muted: #64748b;   /* slate-500 */
  --color-accent: #2563eb;       /* blue-600 */
  --color-accent-hover: #1d4ed8; /* blue-700 */
  --color-danger: #dc2626;       /* red-600 */
  --color-warning: #d97706;      /* amber-600 */
  --color-success: #059669;      /* emerald-600 */
  --color-focus-ring: 37 99 235; /* rgb of accent */

  --login-grad-x1: 20%;
  --login-grad-y1: 20%;
  --login-grad-x2: 80%;
  --login-grad-y2: 80%;
}

.dark {
  --color-bg: #020617;           /* slate-950 */
  --color-surface: #0f172a;      /* slate-900 */
  --color-surface-alt: #1e293b;  /* slate-800 */
  --color-border: #1e293b;       /* slate-800 */
  --color-border-strong: #334155;/* slate-700 */
  --color-text: #f1f5f9;         /* slate-100 */
  --color-text-muted: #94a3b8;   /* slate-400 */
  --color-accent: #3b82f6;       /* blue-500 (légèrement plus claire pour contraste sombre) */
  --color-accent-hover: #2563eb; /* blue-600 */
  --color-danger: #f87171;       /* red-400 */
  --color-warning: #fbbf24;      /* amber-400 */
  --color-success: #34d399;      /* emerald-400 */
  --color-focus-ring: 59 130 246;/* rgb of accent variant */
}

/* Boutons & contrôles basés sur variables */
.btn-accent {
  @apply inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded-md text-sm font-medium shadow-sm transition active:scale-[.985] disabled:opacity-70 disabled:cursor-not-allowed select-none;
  background: var(--color-accent);
  color: #fff;
}
.btn-accent:hover { background: var(--color-accent-hover); }

.btn-ghost {
  @apply inline-flex items-center justify-center gap-2 px-4 py-2.5 rounded-md text-sm font-medium transition active:scale-[.985];
  background: var(--color-surface-alt);
  color: var(--color-text-muted);
}
.btn-ghost:hover { filter: brightness(0.97); }

.field-base {
  @apply w-full rounded-md text-sm px-3 py-2 outline-none transition;
  background: color-mix(in srgb, var(--color-surface) 94%, transparent);
  border: 1px solid var(--color-border);
  color: var(--color-text);
}
.field-base:focus {
  border-color: var(--color-accent);
  box-shadow: 0 0 0 3px rgba(var(--color-focus-ring)/0.35);
}
.dark .field-base { background: color-mix(in srgb, var(--color-surface) 88%, transparent); }

/* Tags feedback */
.alert-error {
  @apply rounded-lg px-3 py-2 text-xs flex items-start gap-2 border;
  background: color-mix(in srgb, var(--color-danger) 8%, transparent);
  border-color: color-mix(in srgb, var(--color-danger) 35%, transparent);
  color: var(--color-danger);
}
.dark .alert-error { background: color-mix(in srgb, var(--color-danger) 18%, transparent); }

.alert-warn {
  @apply rounded-lg px-3 py-2 text-xs flex items-start gap-2 border;
  background: color-mix(in srgb, var(--color-warning) 10%, transparent);
  border-color: color-mix(in srgb, var(--color-warning) 38%, transparent);
  color: var(--color-warning);
}

/* Progress bar accent */
.progress-accent { background: linear-gradient(90deg,var(--color-accent),var(--color-accent-hover)); }

/* Transition douce lors du changement de thème */
.theme-transition {
  transition: color .25s ease, background-color .25s ease, border-color .25s ease, fill .25s ease, stroke .25s ease;
}

/* Transition douce lors de l'activation du mode focus */
.focus-transition, .focus-transition body, .focus-transition * {
  transition: background-color .3s ease, color .3s ease, border-color .3s ease, box-shadow .3s ease, fill .3s ease, stroke .3s ease;
}

/* --------------------------------------------------
   Mode Focus Monochrome
   Objectif: réduire distraction: accents atténués sauf éléments interactifs primaires
   Activation: <html data-focus="mono">
   -------------------------------------------------- */
[data-focus='mono'] body {
  --color-accent: #475569; /* slate-600 neutralise saturation */
  --color-accent-hover: #1e293b;
  --color-focus-ring: 71 85 105;
}
[data-focus='mono'] .btn-accent {
  background: linear-gradient(135deg,#1e293b,#475569);
}
[data-focus='mono'] .btn-accent:hover {
  background: linear-gradient(135deg,#0f172a,#1e293b);
}
[data-focus='mono'] .alert-error,[data-focus='mono'] .alert-warn { filter: grayscale(.35) brightness(.95); }
[data-focus='mono'] .progress-accent { background: linear-gradient(90deg,#1e293b,#475569); }
[data-focus='mono'] [data-theme='rose'] .btn-accent,[data-focus='mono'] [data-theme='amber'] .btn-accent,[data-focus='mono'] [data-theme='indigo'] .btn-accent,[data-focus='mono'] [data-theme='emerald'] .btn-accent,[data-focus='mono'] [data-theme='default'] .btn-accent { background: linear-gradient(135deg,#1e293b,#475569); }
[data-focus='mono'] a { text-decoration-color: rgba(100,116,139,.4); }
[data-focus='mono'] .card-accent-shadow { box-shadow: 0 4px 18px -4px rgba(15,23,42,.25); }

[data-focus='mono'].dark body, .dark [data-focus='mono'] body {
  --color-accent: #64748b; /* légèrement plus clair en dark */
  --color-accent-hover: #475569;
  --color-focus-ring: 100 116 139;
}
[data-focus='mono'].dark .btn-accent, .dark [data-focus='mono'] .btn-accent {
  background: linear-gradient(135deg,#0f172a,#334155);
}
[data-focus='mono'].dark .btn-accent:hover, .dark [data-focus='mono'] .btn-accent:hover {
  background: linear-gradient(135deg,#020617,#1e293b);
}

/* --------------------------------------------------
   Thèmes alternatifs via [data-theme]
   Pour activer: document.documentElement.dataset.theme = 'emerald'
   -------------------------------------------------- */
[data-theme='emerald'] {
  --color-accent: #059669;        /* emerald-600 */
  --color-accent-hover: #047857;  /* emerald-700 */
  --color-focus-ring: 5 150 105;  /* rgb emerald-600 */
}
[data-theme='emerald'].dark, .dark [data-theme='emerald'] { /* si on applique sur html directement en mode dark */
  --color-accent: #10b981;        /* emerald-500 */
  --color-accent-hover: #059669;  /* emerald-600 */
  --color-focus-ring: 16 185 129; /* rgb emerald-500 */
}

/* Indigo */
[data-theme='indigo'] {
  --color-accent: #4f46e5;        /* indigo-600 */
  --color-accent-hover: #4338ca;  /* indigo-700 */
  --color-focus-ring: 79 70 229;  /* rgb */
}
[data-theme='indigo'].dark, .dark [data-theme='indigo'] {
  --color-accent: #6366f1;        /* indigo-500 */
  --color-accent-hover: #4f46e5;  /* indigo-600 */
  --color-focus-ring: 99 102 241;
}

/* Amber */
[data-theme='amber'] {
  --color-accent: #d97706;        /* amber-600 */
  --color-accent-hover: #b45309;  /* amber-700 */
  --color-focus-ring: 217 119 6;
}
[data-theme='amber'].dark, .dark [data-theme='amber'] {
  --color-accent: #f59e0b;        /* amber-500 */
  --color-accent-hover: #d97706;  /* amber-600 */
  --color-focus-ring: 245 158 11;
}

/* Rose */
[data-theme='rose'] {
  --color-accent: #e11d48;        /* rose-600 */
  --color-accent-hover: #be123c;  /* rose-700 */
  --color-focus-ring: 225 29 72;
}
[data-theme='rose'].dark, .dark [data-theme='rose'] {
  --color-accent: #f43f5e;        /* rose-500 */
  --color-accent-hover: #e11d48;  /* rose-600 */
  --color-focus-ring: 244 63 94;
}

/* Slate Neutral (accent discret mais contrasté) */
[data-theme='slate'] {
  --color-accent: #334155;        /* slate-700ish */
  --color-accent-hover: #1e293b;  /* slate-800 */
  --color-focus-ring: 51 65 85;
}
[data-theme='slate'].dark, .dark [data-theme='slate'] {
  --color-accent: #64748b;        /* slate-500 */
  --color-accent-hover: #475569;  /* slate-600 */
  --color-focus-ring: 100 116 139;
}

/* Exemple extensible (commenté) pour un futur thème violet
 [data-theme='violet'] {
   --color-accent: #7c3aed;
   --color-accent-hover: #6d28d9;
   --color-focus-ring: 124 58 237;
 } */

/* Reset et base */
body {
  font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
  margin: 0;
  background: var(--color-bg);
  color: var(--color-text);
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* Legacy global input/button (garder pour compat retro mais encourager classes utilitaires) */
input {
  padding: 8px;
  margin: 8px 0;
  width: 100%;
  max-width: 320px;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  outline: none;
  transition: box-shadow 0.15s ease, border-color 0.15s ease;
  background: var(--color-surface);
  color: var(--color-text);
}
input:focus { border-color: var(--color-accent); box-shadow: 0 0 0 3px rgba(var(--color-focus-ring)/0.35); }

button {
  padding: 8px 12px;
  background: var(--color-accent);
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.2s;
}
button:hover { background: var(--color-accent-hover); }

/* (Legacy dashboard utility classes removed – refactor uses Tailwind + component scoping) */

/* Export Menu */
.export-menu {
  position: relative;
}

.export-menu-items {
  position: absolute;
  right: 0;
  margin-top: 0.5rem;
  background: white;
  border-radius: 6px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  width: 200px;
  z-index: 10;
}

.export-menu-items button {
  width: 100%;
  padding: 0.75rem 1rem;
  text-align: left;
  background: none;
  color: #1e293b;
  border: none;
  font-size: 0.875rem;
}

.export-menu-items button:hover {
  background: #f1f5f9;
}

.button-primary {
  background: #2563eb;
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  font-weight: 500;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.button-primary:hover {
  background: #1d4ed8;
}

.icon {
  font-size: 0.75rem;
}

/* Loading State */
.loading {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 400px;
  font-size: 1rem;
  color: #64748b;
}

/* Subtle fade-in animation for insights/cards */
@keyframes fadeInSoft {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fadeInSoft 300ms ease-out both;
}

/* Slight scale/translate combo for cards (used progressively) */
@keyframes cardRise {
  from { opacity: 0; transform: translateY(8px) scale(.98); }
  to { opacity: 1; transform: translateY(0) scale(1); }
}
.animate-card-rise { animation: cardRise 420ms cubic-bezier(.16,.84,.44,1) both; }

/* Utility for staggering inside flex/grid without manual nth-child delays */
.stagger-children > * { opacity: 0; animation: fadeInSoft 300ms ease-out forwards; }
.stagger-children > *:nth-child(1) { animation-delay: 40ms; }
.stagger-children > *:nth-child(2) { animation-delay: 100ms; }
.stagger-children > *:nth-child(3) { animation-delay: 160ms; }
.stagger-children > *:nth-child(4) { animation-delay: 220ms; }
.stagger-children > *:nth-child(5) { animation-delay: 280ms; }
.stagger-children > *:nth-child(6) { animation-delay: 340ms; }

/* Optional helper to stagger children when needed */
.animate-fade-in-stagger > * {
  animation: fadeInSoft 300ms ease-out both;
}
.animate-fade-in-stagger > *:nth-child(1) { animation-delay: 0ms; }
.animate-fade-in-stagger > *:nth-child(2) { animation-delay: 60ms; }
.animate-fade-in-stagger > *:nth-child(3) { animation-delay: 120ms; }
.animate-fade-in-stagger > *:nth-child(4) { animation-delay: 180ms; }
.animate-fade-in-stagger > *:nth-child(5) { animation-delay: 240ms; }
.animate-fade-in-stagger > *:nth-child(6) { animation-delay: 300ms; }

/* Loading Spinner */
.loading-spinner {
  width: 48px;
  height: 48px;
  border: 5px solid rgba(37, 99, 235, 0.2);
  border-radius: 50%;
  border-top-color: #2563eb;
  animation: spinner 1s linear infinite;
}

@keyframes spinner {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Styles spécifiques pour la page de login */
.animated-login-gradient {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at var(--login-grad-x1) var(--login-grad-y1), rgba(var(--color-accent-rgb,14,165,233),0.55), transparent 60%),
              radial-gradient(circle at var(--login-grad-x2) var(--login-grad-y2), rgba(var(--color-accent-rgb,37,99,235),0.45), transparent 65%),
              linear-gradient(125deg, rgba(var(--color-accent-rgb,14,165,233),0.25), rgba(var(--color-accent-rgb,37,99,235),0.15));
  filter: saturate(1.15) brightness(1.02);
  animation: loginGradientPulse 14s ease-in-out infinite alternate;
}

@keyframes loginGradientPulse {
  0% { filter: saturate(1.1) brightness(1.0); }
  50% { filter: saturate(1.25) brightness(1.05); }
  100% { filter: saturate(1.15) brightness(1.02); }
}

@media (prefers-reduced-motion: reduce) {
  .animated-login-gradient { animation: none; }
}